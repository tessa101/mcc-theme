{% comment %} MCC Landing — Instagram (manual grid or app slot) {% endcomment %}

<section class="mcc-ig" data-mcc-landing="instagram">
  {% if section.settings.title != blank %}
    <h1 class="mi-title">{{ section.settings.title }}</h1>
  {% endif %}
  {% if section.settings.handle != blank %}
    <p class="mi-handle">@{{ section.settings.handle }}</p>
  {% endif %}

  {% if section.blocks.size > 0 %}
    <ul class="mi-grid" data-cascade>
      {% for block in section.blocks limit: section.settings.limit %}
        {% assign url = block.settings.post_url %}
        {% assign thumb = block.settings.thumbnail %}
        <li class="mi-item scroll-trigger animate--fade-in scroll-trigger--offscreen">
          <a href="{{ url }}" target="_blank" rel="noopener">
            {% if thumb != blank %}
              {{ thumb | image_url: width: 720 | image_tag: class: 'mi-img', alt: 'Instagram post' }}
            {% else %}
              <div class="mi-fpo"></div>
            {% endif %}
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <!-- App slot: drop an Instagram app block here -->
    {%- comment -%} Prefer an @app block if present; else show manual posts {%- endcomment -%}
{%- assign rendered_app = false -%}
{%- for block in section.blocks -%}
  {%- if block.type == '@app' and rendered_app == false -%}
    {% render block %}
    {%- assign rendered_app = true -%}
  {%- endif -%}
{%- endfor -%}

{%- unless rendered_app -%}
  <ul class="mi-grid" role="list" data-cascade {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}>
    {%- for block in section.blocks -%}
      {%- if block.type == 'post' -%}
        <li class="mi-item scroll-trigger animate--fade-in scroll-trigger--offscreen" {{ block.shopify_attributes }}>
          <a href="{{ block.settings.post_url }}" target="_blank" rel="noopener nofollow">
            {%- if block.settings.thumbnail != blank -%}
              {{ block.settings.thumbnail | image_url: width: 640 | image_tag:
                sizes: "(max-width:740px) 33vw, 200px",
                alt: "Instagram post thumbnail",
                class: "mi-thumb" }}
            {%- else -%}
              <div class="mi-thumb mi-thumb--placeholder"></div>
            {%- endif -%}
          </a>
        </li>
      {%- endif -%}
    {%- endfor -%}
  </ul>
{%- endunless -%}

  {% endif %}
</section>

<style>
.mcc-ig{ padding:100px 0; background:#fff !important; text-align:center; }
/* Instagram app container background */
#insta-feed,
.mcc-ig #insta-feed {
  background: #fff !important;
}
.mi-title,
/* Instagram app fallback */
#insta-feed h1,
#insta-feed h2 { 
  font-family: 'Passion One', var(--font-sans, 'SuisseIntl', system-ui) !important;
  font-weight: 400 !important;
  font-size: 58px !important;
  line-height: 58px !important;
  color: #232527 !important;
  margin: 0 0 16px !important;
  text-transform: none !important;
  letter-spacing: 0em !important;
}
.mi-handle{ margin:6px 0 20px; opacity:.7; }
.mi-grid{ display:grid; grid-template-columns:repeat(6, minmax(0,1fr)); gap:10px; padding:0; margin:0 auto; max-width:1200px; list-style:none; }
@media (max-width: 1100px){ .mi-grid{ grid-template-columns:repeat(4,1fr);} }
@media (max-width: 720px){ .mi-grid{ grid-template-columns:repeat(3,1fr);} }
.mi-item a{ display:block; }
.mi-img{ width:100%; height:100%; aspect-ratio:1/1; object-fit:cover; border-radius:10px; }
.mi-fpo{ background:#eee; width:100%; aspect-ratio:1/1; border-radius:10px; }

/* Mobile responsive */
@media (max-width: 768px) {
  .mcc-ig .mi-title,
  .mcc-ig h1.mi-title,
  .mcc-ig h2.mi-title,
  #insta-feed h1,
  #insta-feed h2,
  #insta-feed h1[style],
  #insta-feed h2[style],
  .mcc-ig #insta-feed h1,
  .mcc-ig #insta-feed h2,
  .mcc-ig #insta-feed h1[style],
  .mcc-ig #insta-feed h2[style] {
    font-size: 40px !important;
    line-height: 44px !important;
  }
}
</style>

<script>
// Override Instagram app inline styles on mobile
(function() {
  function overrideInstaFeedTitle() {
    const instaFeed = document.getElementById('insta-feed');
    if (!instaFeed) return;
    
    const title = instaFeed.querySelector('h2');
    if (!title) return;
    
    // Check if we're on mobile (768px or less)
    if (window.innerWidth <= 768) {
      // Override inline style for mobile
      title.style.setProperty('font-size', '40px', 'important');
      title.style.setProperty('line-height', '44px', 'important');
    } else {
      // Desktop: ensure 58px (or remove override to use app setting)
      title.style.setProperty('font-size', '58px', 'important');
      title.style.setProperty('line-height', '58px', 'important');
    }
  }
  
  // Run on load and resize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', overrideInstaFeedTitle);
  } else {
    overrideInstaFeedTitle();
  }
  
  // Also run on resize to handle window size changes
  let resizeTimeout;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(overrideInstaFeedTitle, 100);
  });
  
  // Run after a short delay to catch app-rendered content
  setTimeout(overrideInstaFeedTitle, 500);
})();
</script>

{% schema %}
{
  "name": "MCC Landing — Instagram",
  "settings": [
    { "type": "text", "id": "title", "label": "Title", "default": "Follow our journey." },
    { "type": "text", "id": "handle", "label": "Instagram handle (display only)", "default": "malibucoffeecompany" },
    { "type": "range", "id": "limit", "min": 3, "max": 12, "step": 1, "label": "Max posts to show", "default": 6 }
  ],
  "blocks": [
    { "type": "@app" },
    {
      "type": "post",
      "name": "Post (manual)",
      "settings": [
        { "type": "url", "id": "post_url", "label": "Instagram post URL" },
        { "type": "image_picker", "id": "thumbnail", "label": "Thumbnail (upload a square)" }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [{ "name": "MCC Landing — Instagram (manual)" }]
}
{% endschema %}


