{%- comment -%}
MCC Product Header
- Renders product title (H1)
- Shows "Sold out" chip when ALL variants unavailable
- Adds roast text subhead (no icons)
{%- endcomment -%}

{%- assign in_stock_count = product.variants | where: 'available', true | size -%}

{%- comment -%}
Get roast from metafields in priority order.
Accepts text (e.g., "Medium-Light", "Dark roast") or a number (1–5).
{%- endcomment -%}
{%- assign roast_raw = product.metafields.custom.roast
  | default: product.metafields.coffee.roast_level
  | default: product.metafields.roast.level -%}

{%- unless roast_raw %}
  {%- assign title_lower = product.title | downcase -%}
  {%- assign tags_lower  = product.tags | join: ',' | downcase -%}
  {%- if title_lower contains 'french' or tags_lower contains 'french roast' -%}
    {%- assign roast_raw = 'French' -%}
  {%- elsif title_lower contains 'dark' or tags_lower contains 'dark roast' -%}
    {%- assign roast_raw = 'Dark' -%}
  {%- elsif title_lower contains 'medium-dark' or title_lower contains 'medium dark' or tags_lower contains 'medium-dark' -%}
    {%- assign roast_raw = 'Medium-Dark' -%}
  {%- elsif title_lower contains 'medium-light' or title_lower contains 'medium light' or tags_lower contains 'medium-light' -%}
    {%- assign roast_raw = 'Medium-Light' -%}
  {%- elsif title_lower contains 'medium' or tags_lower contains 'medium roast' -%}
    {%- assign roast_raw = 'Medium' -%}
  {%- elsif title_lower contains 'light' or tags_lower contains 'light roast' -%}
    {%- assign roast_raw = 'Light' -%}
  {%- endif -%}
{%- endunless -%}

{%- comment -%} Normalize to a clean label {%- endcomment -%}
{%- assign roast_label = roast_raw -%}
{%- if roast_label != blank -%}
  {%- assign roast_num = roast_label | plus: 0 -%}
  {%- if roast_num > 0 -%}
    {%- case roast_num -%}
      {%- when 1 -%}{%- assign roast_label = 'Light' -%}
      {%- when 2 -%}{%- assign roast_label = 'Light' -%}
      {%- when 3 -%}{%- assign roast_label = 'Medium' -%}
      {%- when 4 -%}{%- assign roast_label = 'Medium-Dark' -%}
      {%- when 5 -%}{%- assign roast_label = 'Dark' -%}
      {%- else -%}{%- assign roast_label = 'Medium' -%}
    {%- endcase -%}
  {%- else -%}
    {%- assign roast_label = roast_label
      | downcase
      | replace: '–','-' | replace: '—','-'
      | replace: ' roast','' | strip -%}
    {%- case roast_label -%}
      {%- when 'french'       -%}{%- assign roast_label = 'French' -%}
      {%- when 'dark'         -%}{%- assign roast_label = 'Dark' -%}
      {%- when 'medium-dark'  -%}{%- assign roast_label = 'Medium-Dark' -%}
      {%- when 'medium light' -%}{%- assign roast_label = 'Medium-Light' -%}
      {%- when 'medium-light' -%}{%- assign roast_label = 'Medium-Light' -%}
      {%- when 'medium'       -%}{%- assign roast_label = 'Medium' -%}
      {%- when 'light'        -%}{%- assign roast_label = 'Light' -%}
      {%- else -%}
        {%- if roast_label contains 'french' -%}{%- assign roast_label = 'French' -%}
        {%- elsif roast_label contains 'dark' -%}{%- assign roast_label = 'Dark' -%}
        {%- elsif roast_label contains 'medium-dark' or roast_label contains 'full city' -%}{%- assign roast_label = 'Medium-Dark' -%}
        {%- elsif roast_label contains 'medium-light' or roast_label contains 'city' -%}{%- assign roast_label = 'Medium-Light' -%}
        {%- elsif roast_label contains 'medium' -%}{%- assign roast_label = 'Medium' -%}
        {%- elsif roast_label contains 'light' -%}{%- assign roast_label = 'Light' -%}
        {%- else -%}{%- assign roast_label = '' -%}
        {%- endif -%}
    {%- endcase -%}
  {%- endif -%}
{%- endif -%}

<div class="product-header">
  <div class="product-title-wrap">
    <h1 class="product-title">{{ product.title }}</h1>

    {%- if roast_label != blank -%}
      <p class="roast-subhead" aria-label="Roast level">
        {{ roast_label }} roast
      </p>
    {%- endif -%}

    {%- if in_stock_count == 0 -%}
      <span class="status-chip" role="status" aria-live="polite">Sold out</span>
    {%- endif -%}
  </div>
</div>






{%- comment -%}
MCC Product Header
- Renders product title
- Shows a single "Sold out" chip only when ALL variants are unavailable


{%- assign in_stock_count = product.variants | where: 'available', true | size -%}

<div class="product-header">
  <div class="product-title-wrap">
    <h1 class="product-title">{{ product.title }}</h1>
    {%- if in_stock_count == 0 -%}
      <span class="status-chip" role="status" aria-live="polite">Sold out</span>
    {%- endif -%}
  </div>
</div>

{%- endcomment -%}





{%- comment -%}
  <!-- Dynamic Bean Meter (Roast Level) -->
<div class="bean-meter">
  {%- comment -%}
    Pull roast from metafields in priority order.
    Accepts either text (e.g., "Dark roast", "Medium-Dark") or a number 1–5.
  {%- endcomment -%}
  {%- assign roast_raw = product.metafields.custom.roast
    | default: product.metafields.coffee.roast_level
    | default: product.metafields.roast.level -%}

  {%- comment -%} Fallback: infer from title/tags if metafield missing {%- endcomment -%}
  {%- unless roast_raw %}
    {%- assign title_lower = product.title | downcase -%}
    {%- assign tags_lower = product.tags | join: ',' | downcase -%}
    {%- if title_lower contains 'french' or tags_lower contains 'french roast' -%}
      {%- assign roast_raw = 'French' -%}
    {%- elsif title_lower contains 'dark' or tags_lower contains 'dark roast' -%}
      {%- assign roast_raw = 'Dark' -%}
    {%- elsif title_lower contains 'medium-dark' or title_lower contains 'medium dark' -%}
      {%- assign roast_raw = 'Medium-Dark' -%}
    {%- elsif title_lower contains 'medium-light' or title_lower contains 'medium light' -%}
      {%- assign roast_raw = 'Medium-Light' -%}
    {%- elsif title_lower contains 'medium' or tags_lower contains 'medium roast' -%}
      {%- assign roast_raw = 'Medium' -%}
    {%- elsif title_lower contains 'light' or tags_lower contains 'light roast' -%}
      {%- assign roast_raw = 'Light' -%}
    {%- else -%}
      {%- assign roast_raw = 'Medium' -%}
    {%- endif -%}
  {%- endunless -%}

  {%- comment -%}
    Normalize & map to a 1–5 bean_count.
    If metafield is numeric (1–5), use it directly (clamped).
  {%- endcomment -%}
  {%- assign roast_as_number = roast_raw | plus: 0 -%}
  {%- assign bean_count = roast_as_number -%}

  {%- if bean_count > 0 -%}
    {%- if bean_count > 5 -%}{%- assign bean_count = 5 -%}{%- endif -%}
  {%- else -%}
    {%- assign roast_norm = roast_raw | downcase
      | replace: '–', '-' | replace: '—', '-'
      | replace: ' roast', '' | strip -%}

    {%- case roast_norm -%}
      {%- when 'french' -%}{%- assign bean_count = 5 -%}{%- assign roast_label = 'French' -%}
      {%- when 'dark' -%}{%- assign bean_count = 5 -%}{%- assign roast_label = 'Dark' -%}
      {%- when 'medium-dark' -%}{%- assign bean_count = 4 -%}{%- assign roast_label = 'Medium-Dark' -%}
      {%- when 'medium light' -%}{%- assign bean_count = 2 -%}{%- assign roast_label = 'Medium-Light' -%}
      {%- when 'medium-light' -%}{%- assign bean_count = 2 -%}{%- assign roast_label = 'Medium-Light' -%}
      {%- when 'medium' -%}{%- assign bean_count = 3 -%}{%- assign roast_label = 'Medium' -%}
      {%- when 'light' -%}{%- assign bean_count = 2 -%}{%- assign roast_label = 'Light' -%}
      {%- else -%}
        {%- comment -%} Handle common synonyms {%- endcomment -%}
        {%- if roast_norm contains 'french' -%}{%- assign bean_count = 5 -%}{%- assign roast_label = 'French' -%}
        {%- elsif roast_norm contains 'dark' -%}{%- assign bean_count = 5 -%}{%- assign roast_label = 'Dark' -%}
        {%- elsif roast_norm contains 'medium-dark' or roast_norm contains 'full city' -%}
          {%- assign bean_count = 4 -%}{%- assign roast_label = 'Medium-Dark' -%}
        {%- elsif roast_norm contains 'medium-light' or roast_norm contains 'city' -%}
          {%- assign bean_count = 2 -%}{%- assign roast_label = 'Medium-Light' -%}
        {%- elsif roast_norm contains 'medium' -%}{%- assign bean_count = 3 -%}{%- assign roast_label = 'Medium' -%}
        {%- elsif roast_norm contains 'light' -%}{%- assign bean_count = 2 -%}{%- assign roast_label = 'Light' -%}
        {%- else -%}{%- assign bean_count = 3 -%}{%- assign roast_label = 'Medium' -%}
        {%- endif -%}
    {%- endcase -%}
  {%- endif -%}

  {%- if roast_label == blank -%}{%- assign roast_label = roast_raw -%}{%- endif -%}

  <span class="roast-label">{{ roast_label }} roast</span>

  <div class="bean-icons">
    {%- for i in (1..5) -%}
      <span class="bean-icon {% if i <= bean_count %}filled{% endif %}">
        {% render 'mcc-bean-icon' %}
      </span>
    {%- endfor -%}
  </div>
</div>
{%- endcomment -%}


